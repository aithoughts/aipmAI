---
title: 在 CrewAI 中实现分层流程
description: 全面了解和应用 CrewAI 项目中的分层流程的指南，已更新以反映最新的编码实践和功能。
---

## 简介
CrewAI 中的分层流程引入了一种结构化的任务管理方法，模拟了传统组织层级结构，以实现高效的任务委派和执行。这种系统化的工作流程通过确保以最佳效率和准确性处理任务来增强项目成果。

!!! note "复杂性和效率"
    分层流程旨在利用 GPT-4 等高级模型，在处理复杂任务时优化令牌使用，同时提高效率。

## 分层流程概述
默认情况下，CrewAI 中的任务是通过顺序流程管理的。但是，采用分层方法可以在任务管理中实现清晰的层级结构，其中“经理”代理协调工作流程、委派任务并验证结果，以实现简化和有效的执行。该经理代理现在可以由 CrewAI 自动创建，也可以由用户明确设置。

### 主要特点
- **任务委派**：经理代理根据团队成员的角色和能力分配任务。
- **结果验证**：经理评估结果以确保其符合要求的标准。
- **高效的工作流程**：模拟企业结构，提供有条理的任务管理方法。

## 实施分层流程
要利用分层流程，必须将流程属性明确设置为 `Process.hierarchical`，因为默认行为是 `Process.sequential`。定义一个具有指定经理的团队，并建立清晰的指挥链。

!!! note "工具和代理分配"
    在代理级别分配工具，以方便在经理的指导下由指定的代理执行任务委派和执行。还可以在任务级别指定工具，以便在任务执行期间精确控制工具的可用性。

!!! note "经理 LLM 要求"
    配置 `manager_llm` 参数对于分层流程至关重要。系统需要设置经理 LLM 才能正常运行，确保量身定制的决策。

```python
from langchain_openai import ChatOpenAI
from crewai import Crew, Process, Agent

# 使用背景故事、缓存和详细模式的属性定义代理
researcher = Agent(
    role='研究员',
    goal='进行深入分析',
    backstory='经验丰富的数据分析师，善于发现隐藏趋势。',
    cache=True,
    verbose=False,
    # tools=[]  # 可以选择指定；默认为空列表
)
writer = Agent(
    role='作家',
    goal='创建引人入胜的内容',
    backstory='富有创造力的作家，热衷于在技术领域讲故事。',
    cache=True,
    verbose=False,
    # tools=[]  # 可选择指定工具；默认为空列表
)

# 建立具有分层流程和附加配置的团队
project_crew = Crew(
    tasks=[...],  # 在经理的监督下委派和执行的任务
    agents=[researcher, writer],
    manager_llm=ChatOpenAI(temperature=0, model="gpt-4"),  # 如果未设置 manager_agent，则为必填项
    process=Process.hierarchical,  # 指定分层管理方法
    memory=True,  # 启用内存使用以增强任务执行
    manager_agent=None,  # 可选：明确设置特定代理作为经理，而不是 manager_llm
)
```

### 工作流程实际应用
1. **任务分配**：经理从战略上分配任务，同时考虑每个代理的能力和可用工具。
2. **执行和审查**：代理完成其任务，可以选择异步执行和回调函数以简化工作流程。
3. **顺序任务进展**：尽管是一个分层流程，但任务遵循逻辑顺序以顺利进行，并由经理进行监督。

## 结论
在 CrewAI 中采用分层流程，并进行正确的配置和理解系统的能力，可以促进有条理和高效的项目管理方法。利用高级功能和自定义项根据您的特定需求定制工作流程，确保最佳的任务执行和项目成功。
