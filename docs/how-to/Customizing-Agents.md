---
title: 在 CrewAI 中自定义代理
description: 有关为 CrewAI 框架内的特定角色、任务和高级自定义定制代理的综合指南。
---

## 可自定义属性
打造高效的 CrewAI 团队的关键在于能够动态定制您的 AI 代理，以满足任何项目的独特需求。本节介绍您可以自定义的基本属性。

### 用于自定义的关键属性
- **角色**：`role` 指定代理在团队中的工作，例如“分析师”或“客户服务代表”。
- **目标**：`goal` 定义代理的目标，与其角色和团队的总体目标保持一致。
- **背景故事**：`backstory` 为代理的角色提供深度，丰富其在团队中的动机和参与度。
- **工具** *(可选)*：`tools` 表示代理执行任务所使用的能力或方法，从简单的函数到复杂的集成。
- **缓存** *(可选)*：`memory` 确定代理是否应使用缓存来存储工具使用情况。
- **最大 RPM**：设置每分钟最大请求数 (`max_rpm`)。此属性是可选的，可以设置为 `None` 表示没有限制，如果需要，可以对外部服务进行无限次查询。
- **详细** *(可选)*：`verbose` 启用代理操作的详细日志记录，这对调试和优化很有用。具体来说，它提供了对代理执行过程的洞察力，有助于优化性能。
- **允许委派** *(可选)*：`allow_delegation` 控制是否允许代理将任务委派给其他代理。
- **最大迭代次数** *(可选)*：`max_iter` 属性允许用户定义代理为单个任务执行的最大迭代次数，防止无限循环或过长的执行时间。默认值设置为 25，在彻底性和效率之间取得平衡。一旦代理接近此数字，它将尽力给出好的答案。
- **最大执行时间** *(可选)*：`max_execution_time` 设置代理完成任务的最长时间。
- **系统模板** *(可选)*：`system_template` 定义代理的系统格式。
- **提示模板** *(可选)*：`prompt_template` 定义代理的提示格式。
- **响应模板** *(可选)*：`response_template` 定义代理的响应格式。

## 高级自定义选项
除了基本属性之外，CrewAI 还允许进行更深层次的自定义，以显着增强代理的行为和能力。

### 语言模型自定义
可以使用特定的语言模型 (`llm`) 和函数调用语言模型 (`function_calling_llm`) 自定义代理，从而对代理的处理和决策能力进行高级控制。需要注意的是，设置 `function_calling_llm` 允许覆盖默认的团队函数调用语言模型，从而提供更大程度的自定义。

## 性能和调试设置
调整代理的性能并监控其操作对于高效执行任务至关重要。

### 详细模式和 RPM 限制
- **详细模式**：`verbose` 启用代理操作的详细日志记录，这对调试和优化很有用。具体来说，它提供了对代理执行过程的洞察力，有助于优化性能。
- **RPM 限制**：设置每分钟最大请求数 (`max_rpm`)。此属性是可选的，可以设置为 `None` 表示没有限制，如果需要，可以对外部服务进行无限次查询。

### 任务执行的最大迭代次数
`max_iter` 属性允许用户定义代理为单个任务执行的最大迭代次数，防止无限循环或过长的执行时间。默认值设置为 25，在彻底性和效率之间取得平衡。一旦代理接近此数字，它将尽力给出好的答案。

## 自定义代理和工具
通过在初始化期间定义代理的属性和工具来自定义代理。工具对于代理的功能至关重要，使代理能够执行专门的任务。`tools` 属性应该是代理可以使用的工具数组，默认情况下它被初始化为空列表。可以在代理初始化后添加或修改工具，以适应新的需求。

```shell
pip install 'crewai[tools]'
```

### 示例：为代理分配工具
```python
import os
from crewai import Agent
from crewai_tools import SerperDevTool

# 设置工具初始化的 API 密钥
os.environ["OPENAI_API_KEY"] = "您的密钥"
os.environ["SERPER_API_KEY"] = "您的密钥"

# 初始化搜索工具
search_tool = SerperDevTool()

# 使用高级选项初始化代理
agent = Agent(
  role='研究分析师',
  goal='提供最新的市场分析',
  backstory='一位对市场趋势有敏锐眼光的专家分析师。',
  tools=[search_tool],
  memory=True, # 启用内存
  verbose=True,
  max_rpm=None, # 每分钟请求数没有限制
  max_iter=25, # 最大迭代次数的默认值
  allow_delegation=False
)
```

## 委派和自主权
控制代理委派任务或提出问题的能力对于定制其自主权和在 CrewAI 框架内的协作动态至关重要。默认情况下，`allow_delegation` 属性设置为 `True`，使代理能够根据需要寻求帮助或委派任务。这种默认行为促进了 CrewAI 生态系统内的协作解决问题和效率。如果需要，可以禁用委派以满足特定的操作要求。

### 示例：禁用代理的委派
```python
agent = Agent(
  role='内容作者',
  goal='撰写关于市场趋势的引人入胜的内容',
  backstory='一位在市场分析方面具有专业知识的经验丰富的作家。',
  allow_delegation=False # 禁用委派
)
```

## 结论
通过设置角色、目标、背景故事和工具，以及语言模型自定义、内存、性能设置和委派偏好等高级选项，在 CrewAI 中自定义代理，可以打造出一支细致入微且能力强大的 AI 团队，随时准备迎接复杂挑战。
